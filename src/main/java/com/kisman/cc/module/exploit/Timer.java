package com.kisman.cc.module.exploit;

import com.kisman.cc.Kisman;
import com.kisman.cc.event.events.EventPlayerUpdate;
import com.kisman.cc.module.Category;
import com.kisman.cc.module.Module;
import com.kisman.cc.settings.Setting;
import me.zero.alpine.listener.EventHandler;
import me.zero.alpine.listener.Listener;

public class Timer extends Module {
    private Setting speed = new Setting("Ticks", this, 4, 0.1, 10, false);

    public float ovverideSpeed = 1;

    public Timer() {
        super("Timer", "", Category.EXPLOIT);

        setmgr.rSetting(speed);
    }

    public void onEnable() {
        Kisman.EVENT_BUS.subscribe(listener);
    }

    public void onDisable() {
        Kisman.EVENT_BUS.unsubscribe(listener);

        mc.timer.tickLength = 50;
    }

    @EventHandler
    private final Listener<EventPlayerUpdate> listener = new Listener<>(event -> {
        if(ovverideSpeed != 1 && ovverideSpeed > 1) {
            mc.timer.tickLength = 50 / ovverideSpeed;
            return;
        }

        mc.timer.tickLength = 50 / getSpeed();
    });

    private float getSpeed() {
        return Math.max((float) speed.getValDouble(), 0.1f);
    }
}
